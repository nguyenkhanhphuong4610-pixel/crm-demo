<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Spa CRM – Full Cloud Demo</title>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
body{font-family:Arial;background:#f2f4f7;padding:20px}
.card{background:#fff;padding:16px;border-radius:10px;margin-bottom:16px}
input,textarea,button{width:100%;padding:8px;margin-top:6px}
button{background:#e91e63;color:#fff;border:none;border-radius:6px}
.hidden{display:none}
table{width:100%;border-collapse:collapse}
th,td{border:1px solid #ddd;padding:8px;text-align:center}
</style>
</head>

<body>

<div id="login" class="card">
<h2>Đăng nhập</h2>
<input id="user" placeholder="admin">
<input id="pass" type="password" placeholder="123456">
<button onclick="login()">Login</button>
</div>

<div id="app" class="hidden">

<div class="card">
<button onclick="backup()">⬇ Backup dữ liệu</button>
<input type="file" onchange="restore(this)">
</div>

<div class="card">
<h3>Thêm khách</h3>
<input id="name" placeholder="Tên khách">
<input id="phone" placeholder="SĐT">
<textarea id="roadmap" placeholder="Lộ trình"></textarea>
<input id="beforeImg" placeholder="Link before">
<input id="afterImg" placeholder="Link after">
<button onclick="add()">Lưu</button>
</div>

<div class="card">
<table>
<thead><tr><th>Tên</th><th>SĐT</th></tr></thead>
<tbody id="list"></tbody>
</table>
</div>

</div>

<script>
// ===== AUTH =====
function login(){
  if(user.value==="admin" && pass.value==="123456"){
    localStorage.isLogin=true;
    login.classList.add("hidden");
    app.classList.remove("hidden");
    load();
  }
}

// ===== FIREBASE =====
const firebaseConfig = {
  apiKey: "XXX",
  authDomain: "XXX",
  projectId: "XXX",
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// ===== CRUD =====
async function add(){
  await db.collection("customers").add({
    name:name.value,
    phone:phone.value,
    roadmap:roadmap.value.split("\n"),
    beforeImg:beforeImg.value,
    afterImg:afterImg.value
  });
  load();
}

async function load(){
  list.innerHTML="";
  const snap = await db.collection("customers").get();
  snap.forEach(doc=>{
    const c=doc.data();
    list.innerHTML+=`
      <tr>
        <td>${c.name}</td>
        <td>${c.phone}</td>
      </tr>`;
  });
}

// ===== BACKUP =====
async function backup(){
  const snap = await db.collection("customers").get();
  const data=[];
  snap.forEach(d=>data.push(d.data()));
  const blob=new Blob([JSON.stringify(data)],{type:"application/json"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download="spa-backup.json";
  a.click();
}

// ===== RESTORE =====
function restore(input){
  const file=input.files[0];
  const reader=new FileReader();
  reader.onload=async e=>{
    const data=JSON.parse(e.target.result);
    for(const c of data){
      await db.collection("customers").add(c);
    }
    load();
  };
  reader.readAsText(file);
}
</script>

</body>
</html>