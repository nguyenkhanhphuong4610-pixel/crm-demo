<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>SPA CRM Demo</title>
<style>
body{font-family:Arial;background:#f4f6f8;margin:0}
header{background:#b85c8a;color:#fff;padding:15px;text-align:center}
.container{padding:20px}
input,select,textarea,button{padding:8px;margin:5px 0;width:100%}
button{background:#b85c8a;color:#fff;border:none;cursor:pointer}
button:hover{opacity:.9}
.card{background:#fff;padding:15px;margin-bottom:10px;border-radius:6px}
.hidden{display:none}
.flex{display:flex;gap:10px}
.list-item{cursor:pointer}
</style>
</head>

<body>

<header>SPA CUSTOMER MANAGEMENT</header>

<div class="container">

<!-- LOGIN -->
<div id="loginBox" class="card">
<h3>Đăng nhập</h3>
<input id="loginUser" placeholder="Username">
<input id="loginPass" type="password" placeholder="Password">
<button onclick="login()">Login</button>
</div>

<!-- MAIN -->
<div id="main" class="hidden">

<button onclick="logout()">Đăng xuất</button>
<button onclick="showChangePass()">Đổi mật khẩu</button>

<hr>

<input id="search" placeholder="Tìm khách..." onkeyup="renderCustomers()">

<h3>Thêm khách hàng</h3>
<div class="card">
<input id="name" placeholder="Tên khách">
<input id="birthday" type="date">
<select id="status">
<option>Đang làm</option>
<option>Đã xong</option>
</select>
<input id="staffCare" placeholder="Nhân viên chăm sóc">
<input id="staffSale" placeholder="Nhân viên tư vấn">
<input id="price" placeholder="Giá dịch vụ">
<textarea id="route" placeholder="Lộ trình chăm sóc"></textarea>
<button onclick="addCustomer()">Lưu khách</button>
</div>

<h3>Danh sách khách</h3>
<div id="customerList"></div>

</div>

<!-- DETAIL -->
<div id="detail" class="hidden">
<button onclick="back()">← Quay lại</button>
<div id="detailContent"></div>
</div>

<!-- CHANGE PASS -->
<div id="changePass" class="hidden card">
<h3>Đổi mật khẩu</h3>
<input id="oldPass" type="password" placeholder="Mật khẩu cũ">
<input id="newPass" type="password" placeholder="Mật khẩu mới">
<button onclick="changePassword()">Xác nhận</button>
</div>

</div>

<script>
/* ===== AUTH ===== */
const defaultUser = {username:"admin",password:"123456"}
if(!localStorage.getItem("user")) localStorage.setItem("user",JSON.stringify(defaultUser))

function login(){
 const u=loginUser.value,p=loginPass.value
 const user=JSON.parse(localStorage.getItem("user"))
 if(u===user.username && p===user.password){
  localStorage.setItem("login","1")
  loginBox.classList.add("hidden")
  main.classList.remove("hidden")
  renderCustomers()
 }else alert("Sai tài khoản")
}

function logout(){
 localStorage.removeItem("login")
 location.reload()
}

if(localStorage.getItem("login")){
 loginBox.classList.add("hidden")
 main.classList.remove("hidden")
}

/* ===== CHANGE PASS ===== */
function showChangePass(){
 changePass.classList.toggle("hidden")
}
function changePassword(){
 const user=JSON.parse(localStorage.getItem("user"))
 if(oldPass.value!==user.password) return alert("Sai mật khẩu cũ")
 user.password=newPass.value
 localStorage.setItem("user",JSON.stringify(user))
 alert("Đổi mật khẩu thành công")
 changePass.classList.add("hidden")
}

/* ===== CUSTOMER ===== */
let customers=JSON.parse(localStorage.getItem("customers")||"[]")

function save(){localStorage.setItem("customers",JSON.stringify(customers))}

function addCustomer(){
 const c={
  id:Date.now(),
  name:name.value,
  birthday:birthday.value,
  status:status.value,
  staffCare:staffCare.value,
  staffSale:staffSale.value,
  price:price.value,
  route:route.value,
  before:"",
  after:""
 }
 customers.push(c)
 save()
 renderCustomers()
}

function renderCustomers(){
 const key=search.value.toLowerCase()
 customerList.innerHTML=""
 customers.filter(c=>c.name.toLowerCase().includes(key)).forEach(c=>{
  const d=document.createElement("div")
  d.className="card list-item"
  d.innerHTML=`<b>${c.name}</b> - ${c.status}`
  d.onclick=()=>openDetail(c.id)
  customerList.appendChild(d)
 })
}

function openDetail(id){
 const c=customers.find(x=>x.id===id)
 main.classList.add("hidden")
 detail.classList.remove("hidden")
 detailContent.innerHTML=`
 <h3>${c.name}</h3>
 <p>Ngày sinh: ${c.birthday}</p>
 <p>Trạng thái: ${c.status}</p>
 <p>NV chăm sóc: ${c.staffCare}</p>
 <p>NV tư vấn: ${c.staffSale}</p>
 <p>Giá: ${c.price}</p>
 <textarea onchange="c.route=this.value;save()">${c.route}</textarea>
 <p>Before: <input type="file"></p>
 <p>After: <input type="file"></p>
 `
}

function back(){
 detail.classList.add("hidden")
 main.classList.remove("hidden")
}
</script>

</body>
</html>
