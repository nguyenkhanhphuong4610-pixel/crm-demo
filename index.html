<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>CRM - Full</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
:root{
  --pink-main:#d97c9f;
  --pink-light:#fdecef;
  --pink-bg:#fff5f7;
  --pink-border:#f3c6d3;
}
body{margin:0;font-family:Arial;background:var(--pink-bg)}
header{
  background:var(--pink-main);
  color:#fff;
  padding:14px;
  font-size:18px;
  font-weight:600;
  display:flex;
  justify-content:space-between;
}
nav span{
  margin-left:12px;
  cursor:pointer;
  font-size:14px;
}
nav span:hover{text-decoration:underline}
.container{padding:16px}
.hidden{display:none}

/* ===== DASHBOARD + CRM CSS (GI·ªÆ NGUY√äN) ===== */
.dashboard{display:grid;grid-template-columns:repeat(4,1fr);gap:12px;margin-bottom:16px}
.box{background:#fff;padding:14px;border-radius:8px;border:1px solid var(--pink-border)}
.box h3{margin:0;font-size:13px;color:#777}
.box p{margin-top:6px;font-size:22px;font-weight:bold;color:var(--pink-main)}
.layout{display:grid;grid-template-columns:340px 1fr;gap:16px}
.left,.right{background:#fff;border-radius:8px;padding:14px;border:1px solid var(--pink-border)}
input,select,textarea,button{
  width:100%;padding:9px;margin:6px 0;font-size:14px;
  border-radius:6px;border:1px solid var(--pink-border)
}
button{background:var(--pink-main);color:#fff;font-weight:600;border:none;cursor:pointer}
.customer{padding:10px;border-bottom:1px solid var(--pink-border);cursor:pointer}
.customer:hover{background:var(--pink-light)}
.active{background:var(--pink-light);font-weight:600}
.service{border:1px solid var(--pink-border);padding:8px;border-radius:6px;margin:6px 0}
.delete{background:#c44a6a;margin-top:10px}
label{font-size:13px;color:#777}
hr{border:none;border-top:1px solid var(--pink-border);margin:12px 0}
canvas{max-width:600px;margin:auto}
</style>
</head>

<body>

<header>
  CUSTOMER MANAGEMENT
  <nav>
    <span onclick="showPage('crm')">CRM</span>
    <span onclick="showPage('report')">üìä B√°o c√°o</span>
  </nav>
</header>

<!-- ================= CRM PAGE ================= -->
<div class="container" id="crmPage">

<div class="dashboard">
  <div class="box"><h3>T·ªïng kh√°ch</h3><p id="totalCus">0</p></div>
  <div class="box"><h3>ƒêang l√†m</h3><p id="doingCus">0</p></div>
  <div class="box"><h3>ƒê√£ xong</h3><p id="doneCus">0</p></div>
  <div class="box"><h3>T·ªïng doanh thu</h3><p id="totalMoney">0</p></div>
</div>

<div class="layout">
<div class="left">
<b>Th√™m kh√°ch m·ªõi</b>
<input id="customerName" placeholder="T√™n kh√°ch">
<input id="phone" placeholder="S·ªë ƒëi·ªán tho·∫°i">
<input id="birthday" type="date">
<select id="status">
  <option>ƒêang l√†m</option>
  <option>ƒê√£ xong</option>
</select>
<input id="staffCare" placeholder="Nh√¢n vi√™n chƒÉm s√≥c">
<input id="staffSale" placeholder="Nh√¢n vi√™n t∆∞ v·∫•n">
<textarea id="route" placeholder="L·ªô tr√¨nh chƒÉm s√≥c"></textarea>
<button onclick="addCustomer()">L∆∞u kh√°ch</button>

<hr>
<b>T√¨m ki·∫øm</b>
<input id="searchInput" placeholder="T√™n ho·∫∑c SƒêT..." oninput="renderList()">

<hr>
<b>Danh s√°ch kh√°ch</b>
<div id="list"></div>
</div>

<div class="right" id="detail">
<p>Ch·ªçn kh√°ch ƒë·ªÉ xem chi ti·∫øt</p>
</div>
</div>
</div>

<!-- ================= REPORT PAGE ================= -->
<div class="container hidden" id="reportPage">
<h2>üìä Doanh thu theo nh√¢n vi√™n t∆∞ v·∫•n</h2>
<canvas id="chart"></canvas>
</div>

<script>
let customers=[],currentId=null,chart=null;

/* ---------- PAGE ---------- */
function showPage(p){
  crmPage.classList.toggle("hidden",p!=="crm");
  reportPage.classList.toggle("hidden",p!=="report");
  if(p==="report") renderChart();
}

/* ---------- STORAGE ---------- */
function save(){
  localStorage.setItem("customers",JSON.stringify(customers));
  renderDashboard();
}

/* ---------- LOAD ---------- */
function load(){
  customers=JSON.parse(localStorage.getItem("customers")||"[]");
  renderDashboard();renderList();
}

/* ---------- DASHBOARD ---------- */
function renderDashboard(){
  totalCus.innerText=customers.length;
  doingCus.innerText=customers.filter(c=>c.status==="ƒêang l√†m").length;
  doneCus.innerText=customers.filter(c=>c.status==="ƒê√£ xong").length;
  const total=customers.reduce((s,c)=>s+c.services.reduce((x,sv)=>x+sv.price,0),0);
  totalMoney.innerText=total.toLocaleString();
}

/* ---------- CUSTOMER ---------- */
function addCustomer(){
  if(!customerName.value.trim()) return alert("Thi·∫øu t√™n");
  customers.push({
    id:Date.now(),
    name:customerName.value,
    phone:phone.value,
    birthday:birthday.value,
    status:status.value,
    staffCare:staffCare.value,
    staffSale:staffSale.value,
    route:route.value,
    services:[]
  });
  customerName.value=phone.value=birthday.value=staffCare.value=staffSale.value=route.value="";
  save();renderList();
}

function renderList(){
  const key=searchInput.value.toLowerCase();
  list.innerHTML="";
  customers.filter(c=>
    c.name.toLowerCase().includes(key)||c.phone.includes(key)
  ).forEach(c=>{
    const d=document.createElement("div");
    d.className="customer"+(c.id===currentId?" active":"");
    d.innerHTML=`<b>${c.name}</b><br>${c.phone}`;
    d.onclick=()=>openDetail(c.id);
    list.appendChild(d);
  });
}

function update(key,val){
  customers.find(c=>c.id===currentId)[key]=val;
  save();renderList();
}

/* ---------- SERVICE ---------- */
function addService(){
  const c=customers.find(c=>c.id===currentId);
  if(!serviceName.value||!servicePrice.value) return;
  c.services.push({
    id:Date.now(),
    name:serviceName.value,
    price:Number(servicePrice.value),
    status:"ƒêang l√†m"
  });
  serviceName.value=servicePrice.value="";
  save();openDetail(currentId);
}

function openDetail(id){
  currentId=id;renderList();
  const c=customers.find(c=>c.id===id);
  const services=c.services.map(s=>`
    <div class="service">
      <b>${s.name}</b> - ${s.price.toLocaleString()}ƒë
    </div>`).join("");
  detail.innerHTML=`
    <h3>${c.name}</h3>
    <label>SƒêT</label>
    <input value="${c.phone}" onchange="update('phone',this.value)">
    <label>Nh√¢n vi√™n t∆∞ v·∫•n</label>
    <input value="${c.staffSale}" onchange="update('staffSale',this.value)">
    <hr>
    <input id="serviceName" placeholder="T√™n d·ªãch v·ª•">
    <input id="servicePrice" type="number" placeholder="Gi√°">
    <button onclick="addService()">Th√™m d·ªãch v·ª•</button>
    <hr>${services||"<i>Ch∆∞a c√≥ d·ªãch v·ª•</i>"}
  `;
}

/* ---------- CHART ---------- */
function renderChart(){
  const map={};
  customers.forEach(c=>{
    const k=c.staffSale||"Ch∆∞a g√°n";
    const t=c.services.reduce((s,x)=>s+x.price,0);
    map[k]=(map[k]||0)+t;
  });
  if(chart) chart.destroy();
  chart=new Chart(document.getElementById("chart"),{
    type:"pie",
    data:{
      labels:Object.keys(map),
      datasets:[{data:Object.values(map)}]
    }
  });
}

load();
</script>

</body>
</html>