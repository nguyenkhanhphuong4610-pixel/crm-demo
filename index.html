<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>SPA CRM - Quản lý khách hàng</title>
<style>
body{
  font-family: Arial, sans-serif;
  background:#f4f6f8;
  margin:0;
}
header{
  background:#8b3f64;
  color:#fff;
  padding:16px;
  text-align:center;
  font-size:20px;
  font-weight:600;
}
.container{
  padding:20px;
}
input, select, textarea, button{
  width:100%;
  padding:8px;
  margin:6px 0;
  box-sizing:border-box;
  font-size:14px;
}
button{
  background:#8b3f64;
  color:#fff;
  border:none;
  border-radius:4px;
  cursor:pointer;
}
button:hover{
  opacity:0.9;
}
.card{
  background:#fff;
  padding:16px;
  margin-bottom:14px;
  border-radius:6px;
}
.hidden{
  display:none;
}
.list-item{
  cursor:pointer;
}
.list-item:hover{
  background:#f2f2f2;
}
label{
  font-size:13px;
  color:#555;
}
.section-title{
  font-size:16px;
  font-weight:600;
  margin:18px 0 8px;
}
.back-btn{
  margin-bottom:12px;
  background:#666;
}
.delete-btn{
  background:#b02a2a;
  margin-top:12px;
}
</style>
</head>

<body>

<header>SPA CUSTOMER MANAGEMENT</header>

<div class="container">

<!-- MAIN -->
<div id="main">

<input id="search" placeholder="Tìm kiếm khách hàng theo tên" onkeyup="renderCustomers()">

<div class="section-title">Thêm khách hàng</div>
<div class="card">
  <label>Tên khách hàng</label>
  <input id="name">

  <label>Ngày sinh</label>
  <input id="birthday" type="date">

  <label>Trạng thái</label>
  <select id="status">
    <option>Đang làm</option>
    <option>Đã xong</option>
  </select>

  <label>Nhân viên chăm sóc</label>
  <input id="staffCare">

  <label>Nhân viên tư vấn</label>
  <input id="staffSale">

  <label>Giá dịch vụ</label>
  <input id="price">

  <label>Lộ trình chăm sóc</label>
  <textarea id="route"></textarea>

  <button onclick="addCustomer()">Lưu khách hàng</button>
</div>

<div class="section-title">Danh sách khách hàng</div>
<div id="customerList"></div>

</div>

<!-- DETAIL -->
<div id="detail" class="hidden">
<button class="back-btn" onclick="back()">Quay lại danh sách</button>
<div id="detailContent" class="card"></div>
</div>

</div>

<script>
let customers = JSON.parse(localStorage.getItem("customers") || "[]");

function save(){
  localStorage.setItem("customers", JSON.stringify(customers));
}

function addCustomer(){
  if(!name.value.trim()){
    alert("Vui lòng nhập tên khách hàng");
    return;
  }

  customers.push({
    id: Date.now(),
    name: name.value,
    birthday: birthday.value,
    status: status.value,
    staffCare: staffCare.value,
    staffSale: staffSale.value,
    price: price.value,
    route: route.value
  });

  save();
  name.value = birthday.value = staffCare.value =
  staffSale.value = price.value = route.value = "";

  renderCustomers();
}

function renderCustomers(){
  const key = search.value.toLowerCase();
  customerList.innerHTML = "";

  customers
    .filter(c => c.name.toLowerCase().includes(key))
    .forEach(c => {
      const div = document.createElement("div");
      div.className = "card list-item";
      div.innerHTML = `
        <strong>${c.name}</strong><br>
        Trạng thái: ${c.status}<br>
        Nhân viên chăm sóc: ${c.staffCare || "-"}
      `;
      div.onclick = () => openDetail(c.id);
      customerList.appendChild(div);
    });
}

function openDetail(id){
  const c = customers.find(x => x.id === id);
  main.classList.add("hidden");
  detail.classList.remove("hidden");

  detailContent.innerHTML = `
    <div class="section-title">Thông tin khách hàng</div>

    <label>Trạng thái</label>
    <select onchange="update(${c.id}, 'status', this.value)">
      <option ${c.status==="Đang làm"?"selected":""}>Đang làm</option>
      <option ${c.status==="Đã xong"?"selected":""}>Đã xong</option>
    </select>

    <label>Nhân viên chăm sóc</label>
    <input value="${c.staffCare}" onchange="update(${c.id}, 'staffCare', this.value)">

    <label>Nhân viên tư vấn</label>
    <input value="${c.staffSale}" onchange="update(${c.id}, 'staffSale', this.value)">

    <label>Giá dịch vụ</label>
    <input value="${c.price}" onchange="update(${c.id}, 'price', this.value)">

    <label>Lộ trình chăm sóc</label>
    <textarea onchange="update(${c.id}, 'route', this.value)">${c.route}</textarea>

    <button class="delete-btn" onclick="removeCustomer(${c.id})">
      Xoá khách hàng
    </button>
  `;
}

function update(id, key, value){
  const c = customers.find(x => x.id === id);
  c[key] = value;
  save();
}

function removeCustomer(id){
  if(confirm("Bạn có chắc muốn xoá khách hàng này?")){
    customers = customers.filter(c => c.id !== id);
    save();
    back();
    renderCustomers();
  }
}

function back(){
  detail.classList.add("hidden");
  main.classList.remove("hidden");
}

renderCustomers();
</script>

</body>
</html>
